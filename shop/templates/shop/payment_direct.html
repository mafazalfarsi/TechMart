{% extends 'shop/base.html' %}

{% block title %}Payment - Direct Thawani{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            
            <!-- Error Messages -->
            {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="card">
                <div class="card-header">
                    <h3 class="text-center">Payment</h3>
                </div>
                <div class="card-body">
                    
                    <!-- Cart Summary -->
                    <div class="mb-4">
                        <h5>Order Summary</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in cart_items %}
                                    <tr>
                                        <td>{{ item.product_name }}</td>
                                        <td>{{ item.quantity }}</td>
                                        <td>{{ item.price }} OMR</td>
                                        <td>{{ item.total }} OMR</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr class="table-info">
                                        <td colspan="3" class="text-end"><strong>Total:</strong></td>
                                        <td><strong>{{ total_amount }} OMR</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="mb-4">
                        <h5>Select Payment Method</h5>
                        
                        <!-- Thawani Pay Option -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6 class="mb-1">ðŸ’³ Thawani Pay</h6>
                                        <p class="text-muted mb-0">Secure payment gateway for Oman - Accepts card payments</p>
                                        <small class="text-info">Recommended for online payments</small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <form method="POST" action="{% url 'thawani_payment_direct' %}">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-credit-card"></i> Pay with Thawani
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cash on Delivery Option -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6 class="mb-1">ðŸ’° Cash on Delivery</h6>
                                        <p class="text-muted mb-0">Pay when you receive your order</p>
                                        <small class="text-warning">Available for local deliveries</small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <a href="{% url 'order_confirmation' %}" class="btn btn-success">
                                            <i class="fas fa-money-bill"></i> Pay on Delivery
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Manual Payment Option -->
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6 class="mb-1">ðŸ“ž Manual Payment</h6>
                                        <p class="text-muted mb-0">Contact us for alternative payment methods</p>
                                        <small class="text-secondary">Bank transfer, mobile payment, etc.</small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <a href="mailto:support@example.com?subject=Payment%20Inquiry" class="btn btn-outline-secondary">
                                            <i class="fas fa-envelope"></i> Contact Us
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Payment Instructions:</h6>
                        <ul class="mb-0">
                            <li><strong>Thawani Pay:</strong> You will be redirected to Thawani's secure payment page</li>
                            <li><strong>Cash on Delivery:</strong> Pay when you receive your order</li>
                            <li><strong>Manual Payment:</strong> Contact us for alternative payment options</li>
                            <li>All payments are processed securely</li>
                        </ul>
                    </div>

                    <!-- Troubleshooting -->
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle"></i> Having Issues?</h6>
                        <ul class="mb-0">
                            <li>If Thawani Pay doesn't work, try Cash on Delivery</li>
                            <li>Clear your browser cache if you see errors</li>
                            <li>Contact us if you need help with payment</li>
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 